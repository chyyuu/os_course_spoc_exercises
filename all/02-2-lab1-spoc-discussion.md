# lab1 SPOC思考题



描述符特权级DPL、当前特权级CPL和请求特权级RPL的含义是什么？在哪些寄存器中这些字段？对应的访问条件是什么？ (challenge)写出一些简单的小程序（c or asm）来体现这些特权级的区别和联系。
 ```
 答：CPL是当前进程的特权级，存放在CS寄存器的低两位，为0代表当前进程处于内核态，为3代表当前进程处于用户态。
	 RPL说明的是进程对段访问的请求权限，每个段选择子有自己的RPL。RPL说明的是实际上进程对段访问时的权限，类似于参数，当进程访问段时，可以设置段选择子中的RPL权限，保证安全性。
	 DPL存储在段描述符中，规定访问该段的权限级别，每个段的DPL固定。问一个段时，需要进程特权级检查，一般要求DPL >= max {CPL, RPL}。正如老师上课所说，EPL=max(RPL,CPL)，如果EPL<=DPL，则可以访问当前进程。
 ```
 ```
  + 建议参见链接“ http://blog.csdn.net/better0332/article/details/3416749 ”对特权级的表述，并查阅指令手册。
  - 
 ```

比较不同特权级的中断切换时的堆栈变化差别；(challenge)写出一些简单的小程序（c or asm）来显示出不同特权级的的中断切换的堆栈变化情况。
 ```
 答：从用户态到内核态变化时：特权级从3变成0。CPU会从当前任务的任务状态段TSS中取得新堆栈的段选择符和偏移量。因为中断服务程序在内核中，属于0级特权级代码，所以48位的内核态堆栈指针会从TSS的ss0和esp0字段中获得。
 在定位了新堆栈（内核态堆栈）之后，CPU就会首先把原用户态堆栈指针ss和esp压入内核态堆栈，随后把标志积存器eflags的内容和返回位置cs，eip压入内核态堆栈。
	 从内核态到用户态变化时：特权级从0变成3，需要通过retf指令从内核态返回到用户态。
 ```


